machine:
  php:
    version: 7.1.3
  hosts:
    www.test.ci: 127.0.0.1
  environment:
    COMPOSER_DISCARD_CHANGES: true
general:
  artifacts:
    - "build/"
    - "tmp/"
dependencies:
  pre:
    - sudo apt-get update
    - ./etc/circleci/setup-fpm.sh && ./etc/circleci/setup-nginx.sh
    - ./etc/circleci/disable-xdebug.sh
    - ./etc/circleci/setup-app-config.sh && ./etc/circleci/setup-app-permissions.sh
  override:
    - composer install --no-interaction
  post:
    - ./etc/circleci/setup-app-data.sh
    - wget http://selenium-release.storage.googleapis.com/2.53/selenium-server-standalone-2.53.1.jar
    - java -jar selenium-server-standalone-2.53.1.jar:
        background: true
  cache_directories:
    - "vendor"
    - "bin"
test:
  override:
    - ./bin/phpunit
    - ./bin/phpspec run --no-interaction
    - ./bin/behat --strict
    - ./bin/phing check-codestandards
    #- ./bin/coveralls
    #- ./bin/test-reporter